////////////////////////////////////////////////////////////////////////
// MPI: basics
////////////////////////////////////////////////////////////////////////
#include "td1c.hpp"
////////////////////////////////////////////////////////////////////////
clmpi::clmpi()
{
//nyi  mpi_init();
//nyi  nrank = MPI::COMM_WORLD.Get_size();
//nyi  myrank = MPI::COMM_WORLD.Get_rank();
//nyi  MPI_Get_processor_name(hostname, &hostname_len);

  int ithr;
  #pragma omp parallel default(shared) private(ithr)
  {
    ithr = omp_get_thread_num();
    if (ithr == 0) nthr = omp_get_num_threads();
  }

  print();
}
////////////////////////////////////////////////////////////////////////
clmpi::~clmpi()
{
//nyi  mpi_final();
}
////////////////////////////////////////////////////////////////////////
void clmpi::init()
{
}
////////////////////////////////////////////////////////////////////////
void clmpi::final()
{
}
////////////////////////////////////////////////////////////////////////
void clmpi::clear()
{
  printf("clmpi::clear should never be called.\n");
  abort();
}
////////////////////////////////////////////////////////////////////////
void clmpi::print() const
{
//nyi  printf("# %s: rank %10d of %10d: with %10d threads\n",
//nyi	 hostname, myrank, nrank, nthr);
}
////////////////////////////////////////////////////////////////////////
void clmpi::omp_divide(int ithr, int ll0, int ul0, int& ll1, int& ul1) const
{
  int ntot = ul0 - ll0 + 1;
  int npp = ntot / nthr;

  if (ithr == nthr - 1) {
    ll1 = npp * ithr + ll0;
    ul1 = ul0;
  } else {
    ll1 = npp * ithr + ll0;
//Orimo_ECS
    //old ul1 = ll1 + npp - 1;
    ul1 = ll1 + npp;
//Orimo_ECS
  }
}
////////////////////////////////////////////////////////////////////////
void clmpi::mpi_init()
{
//nyi  int required = MPI_THREAD_FUNNELED;
//nyi  int provided = MPI::Init_thread(required);
//nyi  if (provided != required) abort();
}
////////////////////////////////////////////////////////////////////////
void clmpi::mpi_final()
{
//nyi  MPI::Finalize();
}
////////////////////////////////////////////////////////////////////////
void clmpi::mpi_barrier() const
{
//nyi  MPI::COMM_WORLD.Barrier();
}
////////////////////////////////////////////////////////////////////////
